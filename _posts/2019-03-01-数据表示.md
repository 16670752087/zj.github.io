---
title: 数据表示
categories: 计算机网络实验
date: 2019-03-01 10:00:00
---
# 实验题目
数据表示实验
# 实验目的
掌握结构数据的保存和读取的方法。
# 实验说明
 - 把源程序和可执行文件放在相应的上交源码目录中。
 - 截屏用按键(Ctrl+Alt+PrintScreen)截取当前窗口
# 参考资料
 - C语言函数分类：http://msdn.microsoft.com/zh-cn/library/2aza74he(v=vs.110).aspx
 - C语言字符串函数：http://msdn.microsoft.com/zh-cn/library/f0151s4x(v=vs.110).aspx
# 实验环境
 - Windows + VS 2012  http://172.18.187.11/netdisk/default.aspx?vm=16net
 - Linux + gcc

这里我使用的环境是Windows 10 + VSCode + gcc version 8.1.0 (x86_64-posix-sjlj-rev0, Built by MinGW-W64 project)
# 实验内容
## 结构数据保存和读出
### 实验要求：
循环输入员工(Person)的信息，每输入一个员工的信息，立即写入文件(Persons.txt)，直到输入的姓名为空时跳出循环。然后，读出该文件，显示每个Person的信息。
Person的信息表示：
```cpp
struct Person
{
  char username[USER_NAME_LEN];      // 员工名
  int level;                         // 工资级别
  char email[EMAIL_LEN];             // email地址
  DWORD sendtime;                    // 发送时间
  time_t regtime;                    // 注册时间
};
```
### 截屏运行结果
### 源代码
按照CSV格式保存。CSV格式比较重要的特性是：

如果字段中有逗号（,），该字段使用双引号（"）括起来；

如果该字段中有双引号，该双引号前要再加一个双引号，然后把该字段使用双引号括起来。
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef unsigned long DWORD;
struct CSV
{
	vector<vector<string>> v;
	void get(istream &is)
	{
		string s;
		for (v.clear(); getline(is, s);)
		{
			v.push_back({});
			for (istringstream sin(s); getline(sin, s, ',');)
				v.back().push_back(s);
		}
	}
	void put(ostream &os)
	{
		for (int i = 0; i < v.size(); ++i)
			for (int j = 0; j < v[i].size(); ++j)
				os << v[i][j] << (j + 1 < v[i].size() ? ',' : '\n');
	}
};
struct Person
{
	string username;				   // 员工名
	int level;						   // 工资级别
	string email;					   // email地址
	DWORD sendtime;					   // 发送时间
	time_t regtime;					   // 注册时间
	bool get(istream &is, ostream &os) //从is中读入，并将提示信息写入os；若读入终止返回false
	{
		os << "Input username: ";
		getline(is, username);
		while (!username.empty() && username.back() == ' ')
			username.pop_back(); //删除多余空格
		if (username.empty())	//读入空串，说明已经终止
			return 0;
		os << "Input level: ";
		is >> level;
		os << "Input email: ";
		is >> email;
		os << "Input sendtime: ";
		is >> sendtime;
		os << "Input regtime: ";
		is >> regtime;
		string s;
		return getline(is, s), 1; //要读掉上一行的行末的回车，以免对下一次读入产生影响
	}
	void getCSV(vector<string> &v) //从CSV的某一行读入信息
	{
		username = v[0];
		level = stoi(v[1]);
		email = v[2];
		sendtime = stoull(v[3]);
		regtime = stoull(v[4]);
	}
	string putFileCSV() //返回CSV格式的信息
	{
		return username + "," + to_string(level) + "," + email + "," + to_string(sendtime) + "," + to_string(regtime) + "\n";
	}
	friend ostream &operator<<(ostream &os, Person &p) //打印p的信息到os
	{
		return os << "username: " << p.username << "\n"
				  << "level: " << p.level << "\n"
				  << "email: " << p.email << "\n"
				  << "sendtime: " << p.sendtime << "\n"
				  << "regtime: " << p.regtime << "\n\n";
	}
};
int main()
{
	ofstream fout("Persons.txt");
	for (Person p; p.get(cin, cout);) //从屏幕读入Person直到空
		fout << p.putFileCSV();		  //以CSV格式写入文件
	fout.close();
	ifstream fin("Persons.txt");
	CSV csv;
	csv.get(fin); //读入CSV文件
	fin.close();
	for (auto line : csv.v) //对于读入的每一行信息
	{
		Person p;
		p.getCSV(line);
		cout << p;
	}
}
```
## 多文件合并保存和读出
### 实验要求
循环输入多个文件名（不超过200MB，可以自己确定），每输入一个，就把该文件的文件名（最多300字节）、文件大小(long)和文件内容写入文件FileSet.pak中，输入文件名为空时跳出循环。然后，读FileSet.pak，每读出一个文件就把它原来的文件名加上一个序号保存起来。

合并时可以先取得文件大小，然后边读边写。
### 截屏运行结果
### 源代码
### 与同学互测并截屏运行结果：
把保存的文件给同学，看他是否可以可以取出其中文件，同样可以测试是否可以读出并保存同学的文件。
* 注意结构要相同

【完成情况】
是否完成以下步骤？(√完成 ×未做)
  (1) [ ]  (2) [ ]
是否与同学进行了互测？[  ](√ ×)
互测同学学号姓名：
【实验体会】
写出实验过程中遇到的问题，解决方法和自己的思考;并简述实验体会（如果有的话）。

【交实验报告】
每位同学单独完成本实验内容并填写实验报告。
    交作业地点：http://172.18.187.11/netdisk/default.aspx?vm=17net
编程实验
截止日期：2019年3月9日23：00（周六）。
上传文件：学号_姓名_数据表示实验报告.doc
学号_姓名_数据表示实验源码.rar (源程序和可执行程序)
