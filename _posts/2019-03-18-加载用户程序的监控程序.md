---
categories: 操作系统
---
# 实验题目
加载用户程序的监控程序
# 实验目的
- 设计四个有输出的用户可执行程序，分别在屏幕1/4区域动态输出字符，如将用字符‘A’从屏幕左边某行位置45度角下斜射出，保持一个可观察的适当速度直线运动，碰到屏幕相应1/4区域的边后产生反射，改变方向运动，如此类推，不断运动；在此基础上，增加你的个性扩展，如同时控制两个运动的轨迹，或炫酷动态变色，个性画面，如此等等，自由不限。还要在屏幕某个区域特别的方式显示你的学号姓名等个人信息。
- 修改参考原型代码，允许键盘输入，用于指定运行这四个有输出的用户可执行程序之一，要确保系统执行代码不超过512字节，以便放在引导扇区
- 自行组织映像盘的空间存放四个用户可执行程序。

# 实验要求
## 搭建和应用实验环境
虚拟机安装，生成一个基本配置的虚拟机XXXPC和多个1.44MB容量的虚拟软盘，将其中一个虚拟软盘用DOS格式化为DOS引导盘，用WinHex工具将其中一个虚拟软盘的首扇区填满你的个人信息。
## 接管裸机的控制权
设计IBM_PC的一个引导扇区程序，程序功能是：用字符‘A’从屏幕左边某行位置45度角下斜射出，保持一个可观察的适当速度直线运动，碰到屏幕的边后产生反射，改变方向运动，如此类推，不断运动；在此基础上，增加你的个性扩展，如同时控制两个运动的轨迹，或炫酷动态变色，个性画面，如此等等，自由不限。还要在屏幕某个区域特别的方式显示你的学号姓名等个人信息。将这个程序的机器码放进放进第三张虚拟软盘的首扇区，并用此软盘引导你的XXXPC，直到成功。
# 实验方案
## 实验环境
### 软件
- Windows 10, 64-bit  (Build 17763) 10.0.17763
- Windows Subsystem for Linux [Ubuntu 18.04.2 LTS]：WSL是以软件的形式运行在Windows下的Linux子系统，是近些年微软推出来的新工具，可以在Windows系统上原生运行Linux。
- gcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)：C语言程序编译器，Ubuntu自带。
- NASM version 2.13.02：汇编程序编译器，通过`sudo apt install nasm`安装在WSL上。
- Oracle VM VirtualBox 6.0.4 r128413 (Qt5.6.2)：轻量开源的虚拟机软件。
- VSCode - Insiders v1.33.0：好用的文本编辑器，有丰富的插件。
- hexdump for VSCode 1.7.2: VSCode中一个好用的十六进制显示插件。

这里，没有使用老师推荐的WinHex来打开十六进制，而是使用了VSCode下一个相对好用的插件来查看十六进制；同时，向软盘内填充信息可以直接敲代码解决。

此外，大部分开发环境安装在WSL上，较之于双系统、虚拟机等其他开发方案，更加方便，也方便直接使用Linux下的一些指令。
### 硬件
#### 开发环境配置
所用机器型号为VAIO Z Flip 2016
- Intel(R) Core(TM) i7-6567U CPU @3.30GHZ 3.31GHz
- 8.00GB RAM

#### 虚拟机配置
- 处理器内核总数：1
- RAM：4MB

# 实验过程
```bash
nasm wukos.asm -o wukos.com
nasm a.asm -o a.com
nasm b.asm -o b.com
nasm c.asm -o c.com
nasm d.asm -o d.com
/sbin/mkfs.msdos -C wukos.img 1440
dd if=wukos.com of=wukos.img conv=notrunc
dd if=a.com of=wukos.img seek=1 conv=notrunc
dd if=b.com of=wukos.img seek=2 conv=notrunc
dd if=c.com of=wukos.img seek=3 conv=notrunc
dd if=d.com of=wukos.img seek=4 conv=notrunc
```
# 实验总结
终于有空静下心来做操作系统实验。在第一次的实验过程中，我遇到了很多的问题，包括编译失败、在虚拟机上运行没有正确输出等。通过查找资料、自己动手尝试，检查究竟是哪里出问题，找到问题的根源。

同时，也对老师提供的实验思路展开了一些自己的思考。例如：
1. 向软盘的第一个扇区内填充自己的个人信息，这里我直接使用一段C语言，用二进制打开生成的软盘文件进行操作，方便快捷。
2. 向软盘内写入自己的引导扇区程序，老师课上演示的方案是使用WinHex打开之后手动拷贝，并修改扇区尾部。但是，Linux下其实是有着自己的软盘拷贝指令的（见参考资料），使用这个指令简化了很多操作。

# 参考文献
- 于渊 著. 《Orange‘s：一个操作系统的实现》.  电子工业出版社，2009年6月
- 陈渝、向勇编著. 《操作系统实验指导》.  清华大学出版社，2013年7月
- 李忠著. 《 x86汇编语言-从实模式到保护模式》.电子工业出版社，2013年1月
- [assembly - NASM Error Parsing, Instruction Expected - Stack Overflow](https://stackoverflow.com/questions/11572307/nasm-error-parsing-instruction-expected)
- [Linux dd命令 - 菜鸟教程](http://www.runoob.com/linux/linux-comm-dd.html)
